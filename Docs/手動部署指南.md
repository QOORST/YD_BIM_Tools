# YD_BIM Tools 手動部署指南

## 問題說明

如果在其他電腦上無法使用安裝程式，可以使用手動複製的方式部署。

## 部署步驟

### 1. 準備檔案

在開發電腦上，執行以下 PowerShell 腳本準備部署檔案：

```powershell
.\Tools\PrepareDeployment.ps1
```

這會在 `Output\Deployment` 資料夾中創建完整的部署包。

### 2. 複製到目標電腦

將 `Output\Deployment` 資料夾複製到目標電腦（例如使用 USB 隨身碟）。

### 3. 在目標電腦上執行部署

在目標電腦上，以**系統管理員身分**執行 PowerShell，然後執行：

```powershell
cd "複製的資料夾路徑\Deployment"
.\Deploy.ps1
```

部署腳本會：
1. 自動偵測已安裝的 Revit 版本
2. 詢問要部署到哪些版本
3. 複製所有必要的檔案
4. 創建 .addin 配置檔案
5. 驗證部署結果

### 4. 重新啟動 Revit

關閉所有 Revit 程式，然後重新啟動。

## 手動部署（進階）

如果自動部署腳本無法執行，可以手動複製檔案：

### Revit 2024

1. **創建目標資料夾**：
   ```
   C:\ProgramData\Autodesk\Revit\Addins\2024\YD_BIM\
   ```

2. **複製主程式**：
   - 從 `bin\Release2024\YD_RevitTools.LicenseManager.dll`
   - 到 `C:\ProgramData\Autodesk\Revit\Addins\2024\YD_BIM\`

3. **複製依賴項**（從 `bin\Release2024\` 複製以下檔案）：
   - Newtonsoft.Json.dll
   - System.Text.Json.dll
   - System.Text.Encodings.Web.dll
   - System.Memory.dll
   - System.Buffers.dll
   - System.Runtime.CompilerServices.Unsafe.dll
   - EPPlus.dll
   - EPPlus.Interfaces.dll
   - EPPlus.System.Drawing.dll
   - Microsoft.IO.RecyclableMemoryStream.dll
   - Microsoft.Bcl.AsyncInterfaces.dll
   - System.ComponentModel.Annotations.dll
   - System.Drawing.Common.dll
   - System.Numerics.Vectors.dll
   - System.Text.Encoding.CodePages.dll
   - System.Threading.Tasks.Extensions.dll
   - System.ValueTuple.dll

4. **複製圖示資源**：
   - 從 `Resources\Icons\`
   - 到 `C:\ProgramData\Autodesk\Revit\Addins\2024\YD_BIM\Resources\Icons\`

5. **創建 .addin 檔案**：
   - 在 `C:\ProgramData\Autodesk\Revit\Addins\2024\` 創建檔案
   - 檔名：`YD_RevitTools.LicenseManager.addin`
   - 內容見下方

### Revit 2025 / 2026

步驟相同，只需將路徑中的 `2024` 替換為 `2025` 或 `2026`，並使用對應版本的 DLL。

## .addin 檔案內容

創建文字檔案 `YD_RevitTools.LicenseManager.addin`，內容如下：

```xml
<?xml version="1.0" encoding="utf-8"?>
<RevitAddIns>
  <AddIn Type="Application">
    <Name>YD_BIM Tools</Name>
    <Assembly>C:\ProgramData\Autodesk\Revit\Addins\2024\YD_BIM\YD_RevitTools.LicenseManager.dll</Assembly>
    <FullClassName>YD_RevitTools.LicenseManager.App</FullClassName>
    <ClientId>B3F5D2D4-9392-4A9E-9C0D-A6F5DD93FAC7</ClientId>
    <VendorId>YD</VendorId>
    <VendorDescription>YD BIM Tools, www.ydbim.com</VendorDescription>
  </AddIn>
</RevitAddIns>
```

**注意**：
- Revit 2025 的路徑要改為 `\2025\`
- Revit 2026 的路徑要改為 `\2026\`

## 驗證部署

1. 啟動 Revit
2. 檢查是否出現「YD_BIM Tools」選項卡
3. 如果沒有出現，檢查 Revit 的「外掛管理員」查看錯誤訊息

## 常見問題

### Q: 複製後 Revit 無法載入外掛？

**A**: 檢查以下項目：
1. 檔案路徑是否正確
2. .addin 檔案中的路徑是否正確
3. 所有依賴 DLL 是否都已複製
4. 是否有權限問題（需要系統管理員權限）

### Q: 出現「無法載入檔案或組件」錯誤？

**A**: 
1. 確認所有依賴 DLL 都已複製
2. 檢查 DLL 版本是否匹配
3. 確認 .NET Framework 4.8 已安裝

### Q: 圖示沒有顯示？

**A**: 
1. 確認 `Resources\Icons\` 資料夾已複製
2. 確認圖示檔案（.png）都存在

### Q: 需要在多台電腦部署？

**A**: 
1. 使用 `PrepareDeployment.ps1` 準備部署包
2. 將部署包複製到網路共享資料夾
3. 在每台電腦上執行 `Deploy.ps1`

## 部署檔案清單

完整的部署應包含以下檔案：

```
YD_BIM\
├── YD_RevitTools.LicenseManager.dll (主程式)
├── Newtonsoft.Json.dll
├── System.Text.Json.dll
├── System.Text.Encodings.Web.dll
├── System.Memory.dll
├── System.Buffers.dll
├── System.Runtime.CompilerServices.Unsafe.dll
├── EPPlus.dll
├── EPPlus.Interfaces.dll
├── EPPlus.System.Drawing.dll
├── Microsoft.IO.RecyclableMemoryStream.dll
├── Microsoft.Bcl.AsyncInterfaces.dll
├── System.ComponentModel.Annotations.dll
├── System.Drawing.Common.dll
├── System.Numerics.Vectors.dll
├── System.Text.Encoding.CodePages.dll
├── System.Threading.Tasks.Extensions.dll
├── System.ValueTuple.dll
└── Resources\
    └── Icons\
        ├── license_32.png
        ├── about_32.png
        └── (其他圖示檔案)
```

## 技術支援

如有問題，請聯繫：
- Email: qoorst123456@gmail.com
- 電話: 04-2376-1698

