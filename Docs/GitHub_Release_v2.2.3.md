# YD_BIM Tools v2.2.3 - 錯誤修復版本

**發布日期：** 2025-12-05  
**版本類型：** 🔴 重要更新（Critical Update）  
**更新建議：** 強烈建議所有 v2.2.0 使用者立即更新

---

## 📋 版本摘要

此版本修復了 v2.2.0 中的兩個關鍵問題：
1. **自動更新功能依賴項缺失** - 導致插件無法載入
2. **「值不能為 null」錯誤** - 導致檢查更新功能失敗

---

## 🐛 修復內容

### 1. 修復自動更新功能依賴項缺失問題

**問題描述：**
- 安裝 v2.2.0 後，Revit 無法載入插件
- 錯誤訊息：「無法載入檔案或組件 'System.Text.Json'」

**修復方案：**
- ✅ 添加 `System.Text.Json.dll` (644 KB)
- ✅ 添加 `System.Text.Encodings.Web.dll` (79 KB)
- ✅ 添加 `System.Memory.dll` (142 KB)
- ✅ 添加 `System.Buffers.dll` (21 KB)
- ✅ 添加 `System.Runtime.CompilerServices.Unsafe.dll` (18 KB)

**影響範圍：**
- 所有安裝 v2.2.0 的使用者
- 所有 Revit 版本（2024/2025/2026）

---

### 2. 修復「值不能為 null」錯誤

**問題描述：**
- 點擊「檢查更新」按鈕時出現錯誤
- 錯誤訊息：「檢查更新失敗：值不能為 null。參數名稱：input」

**修復方案：**
- ✅ 添加 HTTP 回應空值檢查
- ✅ 添加 JSON 反序列化結果檢查
- ✅ 添加版本號欄位空值檢查
- ✅ 添加版本號解析異常處理
- ✅ 添加 5 層防禦性檢查

**影響範圍：**
- 所有使用「檢查更新」功能的使用者

---

## 🔨 改進內容

### 1. 全面改進錯誤處理機制

**5 層防禦性檢查：**
1. **第 1 層** - HTTP 回應檢查：檢查伺服器回應是否為空
2. **第 2 層** - JSON 反序列化檢查：檢查 JSON 解析是否成功
3. **第 3 層** - 資料完整性檢查：檢查版本號欄位是否存在
4. **第 4 層** - 版本號解析檢查：安全解析版本號字串
5. **第 5 層** - 異常分類處理：針對不同錯誤提供不同處理

**改進效果：**
- ✅ 更清晰的錯誤訊息
- ✅ 更好的診斷資訊
- ✅ 更友善的使用者提示

---

### 2. 優化異常處理

**分類處理不同類型的異常：**

| 異常類型 | 錯誤訊息 | 解決建議 |
|---------|---------|---------|
| HttpRequestException | 網路連線失敗 | 檢查網路、GitHub 訪問、防火牆 |
| TaskCanceledException | 連線超時 | 檢查網路連線後重試 |
| JsonException | 版本資訊格式錯誤 | 伺服器端問題，稍後再試 |
| Exception | 顯示異常類型和訊息 | 聯繫技術支援 |

**改進效果：**
- ✅ 使用者可以自行診斷問題
- ✅ 減少技術支援負擔
- ✅ 提升使用者體驗

---

### 3. 改進使用者提示

**網路連線失敗時的提示：**
```
網路連線失敗

[錯誤訊息]

請檢查：
• 網路連線是否正常
• 是否可以訪問 GitHub
• 防火牆設定
```

**版本號格式錯誤時的提示：**
```
版本號格式錯誤

無法解析版本號：[實際版本號]
錯誤：[錯誤訊息]
```

---

## 📦 安裝資訊

### 檔案資訊

```
檔案名稱：YD_BIM_Tools_v2.2.3_Setup.exe
檔案大小：2.71 MB (2,838,821 bytes)
MD5 校驗：3B427F651C165C47BC89846DAB94A37D
```

### 支援的 Revit 版本

- ✅ Autodesk Revit 2024
- ✅ Autodesk Revit 2025
- ✅ Autodesk Revit 2026

### 系統需求

- **作業系統：** Windows 10/11 (64-bit)
- **.NET Framework：** 4.8 或更高版本
- **網路連線：** 需要網路連線以使用自動更新功能

---

## 🚀 安裝步驟

### 新安裝

1. 下載 `YD_BIM_Tools_v2.2.3_Setup.exe`
2. 以系統管理員身分執行安裝程式
3. 選擇要安裝的 Revit 版本
4. 完成安裝
5. 啟動 Revit

### 從 v2.2.0 升級

1. **關閉所有 Revit 實例**
2. 下載 `YD_BIM_Tools_v2.2.3_Setup.exe`
3. 執行安裝程式（會自動覆蓋舊版本）
4. 完成安裝
5. 啟動 Revit

**注意：** 不需要解除安裝舊版本，安裝程式會自動處理。

---

## ✅ 驗證安裝

### 檢查依賴項是否已安裝

1. 打開檔案總管
2. 導航到：`C:\ProgramData\Autodesk\Revit\Addins\2024\YD_BIM`（或 2025/2026）
3. 確認以下檔案存在：
   - `YD_RevitTools.LicenseManager.dll`
   - `Newtonsoft.Json.dll`
   - `System.Text.Json.dll`
   - `System.Text.Encodings.Web.dll`
   - `System.Memory.dll`
   - `System.Buffers.dll`
   - `System.Runtime.CompilerServices.Unsafe.dll`

### 測試自動更新功能

1. 啟動 Revit
2. 點擊「YD_BIM Tools」標籤
3. 點擊「檢查更新」按鈕
4. 應該顯示「您已使用最新版本」

---

## 📝 已知問題

目前沒有已知問題。

---

## 🔄 版本歷史

- **v2.2.3** (2025-12-05) - 修復依賴項缺失和錯誤處理問題
- **v2.2.0** (2025-12-05) - 新增自動更新功能和管線避讓工具
- **v2.1.0** (2024-11-20) - 新增 COBie 匯出功能
- **v2.0.0** (2024-10-15) - 整合授權管理系統

---

## 📞 技術支援

如果您在安裝或使用過程中遇到問題：

1. **查看文檔：** 參考使用手冊和 FAQ
2. **GitHub Issues：** https://github.com/QOORST/YD_BIM_Tools/issues
3. **電子郵件：** support@ydbim.com

---

## 📄 授權資訊

YD_BIM Tools 採用專有授權。使用本軟體需要有效的授權金鑰。

---

**感謝您使用 YD_BIM Tools！**

© 2025 YD_BIM Owen. All rights reserved.

